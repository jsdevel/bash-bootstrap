#!/bin/bash

set -e

command -v ctags > /dev/null || {
  echo "You must install ctags first!" >&2
  exit 1
}

excludeArgs='--exclude=.git'
if [[ -f .gitignore ]]; then
  for entry in `cat .gitignore | sed 's:#.*$::g' | sed 's:^!::g' | sed 's:^/::g' | sed 's:/$::g'`;do
    excludeArgs="$excludeArgs --exclude=$entry"
  done
fi

if [[ -f .tags ]]; then
  rm .tags
fi

ctags \
  -f .tags \
  -R \
  --tag-relative=yes \
  $excludeArgs \
  --fields=+l \
  ./*
